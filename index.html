<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Office Bar & Restaurant - Pedidos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        :root {
            --gold: #c5a059;
            --dark: #0a0a0a;
            --gray-light: #f4f4f4;
        }
        body { background-color: var(--dark); color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .bg-gold { background-color: var(--gold); }
        .text-gold { color: var(--gold); }
        .border-gold { border-color: var(--gold); }
        .card-product { background: #1a1a1a; transition: transform 0.2s; }
        .card-product:hover { transform: translateY(-5px); }
        #cart-modal { background: rgba(0,0,0,0.9); }
    </style>
</head>
<body class="pb-20">

    <nav class="p-4 border-b border-gold flex justify-between items-center bg-black sticky top-0 z-50">
        <div class="flex items-center gap-3">
            <img src="logo.jpg" alt="Logo" class="h-12 w-12 rounded-full object-cover border border-gold">
            <div>
                <h1 class="font-bold text-lg leading-none">THE OFFICE</h1>
                <small class="text-gold">Bar & Restaurant</small>
            </div>
        </div>
        <button onclick="toggleAbout()" class="text-sm font-semibold hover:text-gold transition">Acerca de</button>
    </nav>

    <div class="p-6 text-center">
        <p class="text-gray-400 text-sm mb-2"><i class="fas fa-map-marker-alt text-gold"></i> Lecher√≠a, Anzo√°tegui</p>
        <div class="flex justify-center gap-4 text-xl">
            <a href="https://instagram.com/theoffice_bar_restaurant" target="_blank"><i class="fab fa-instagram"></i></a>
            <a href="https://wa.me/584122525407" target="_blank"><i class="fab fa-whatsapp"></i></a>
        </div>
    </div>

    <div class="px-6 mb-4">
        <div class="bg-zinc-900 border border-zinc-800 p-2 rounded text-center text-xs">
            Tasa BCV: <span id="tasa-valor" class="text-gold font-bold">Cargando...</span> Bs.
        </div>
    </div>

    <div id="categories" class="flex gap-2 overflow-x-auto px-6 mb-6 no-scrollbar">
        <button onclick="filterCategory('all')" class="bg-gold text-black px-4 py-1 rounded-full text-sm font-bold whitespace-nowrap">Todos</button>
    </div>

    <main id="products-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4 px-6">
        </main>

    <div id="cart-btn" onclick="openCart()" class="fixed bottom-6 right-6 bg-gold text-black p-4 rounded-full shadow-xl cursor-pointer flex items-center gap-2 hidden z-40">
        <i class="fas fa-shopping-cart"></i>
        <span id="cart-count" class="font-bold">0</span>
    </div>

    <div id="about-modal" class="fixed inset-0 z-[60] flex items-center justify-center p-4 hidden bg-black/80">
        <div class="bg-zinc-900 border border-gold p-8 rounded-lg max-w-sm w-full text-center relative">
            <button onclick="toggleAbout()" class="absolute top-4 right-4 text-gray-400"><i class="fas fa-times"></i></button>
            <h2 class="text-xl font-bold mb-4 text-gold">Desarrollador</h2>
            <p class="mb-2"><strong>Antonio Itriago</strong></p>
            <p class="text-sm text-gray-400 mb-6">Analista, dise√±ador y desarrollador de sistemas de informaci√≥n computarizados.</p>
            <a href="https://wa.me/584122525407" class="text-white border border-white px-4 py-2 rounded-full inline-flex items-center gap-2 hover:bg-white hover:text-black transition">
                 Contactar v√≠a WhatsApp
            </a>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 z-50 flex items-center justify-center p-4 hidden">
        <div class="bg-zinc-900 w-full max-w-md rounded-xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="p-4 border-b border-zinc-800 flex justify-between">
                <h3 class="font-bold">Tu Pedido</h3>
                <button onclick="closeCart()"><i class="fas fa-times"></i></button>
            </div>
            <div id="cart-items" class="p-4 overflow-y-auto flex-1 space-y-4">
                </div>
            <div class="p-4 border-t border-zinc-800 bg-black">
                <div class="flex justify-between mb-2">
                    <span>Total USD:</span>
                    <span id="total-usd" class="font-bold text-gold">$0.00</span>
                </div>
                <div class="flex justify-between mb-4">
                    <span>Total BS (BCV):</span>
                    <span id="total-bs" class="font-bold text-gold">0.00 Bs.</span>
                </div>
                <button onclick="sendOrder()" class="w-full bg-gold text-black font-bold py-3 rounded-lg flex justify-center items-center gap-2">
                    <i class="fab fa-whatsapp"></i> Confirmar y Enviar
                </button>
            </div>
        </div>
    </div>

    <script>
        // CONFIGURACI√ìN
        const CONFIG = {
            SHEET_URL: 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRsTRhoswf3zopWO5PEusQsYdYglnUlWTX9HzFIvewpy4vED9fQbs9Z0V3EdQ-AGMGLlpmcs_LL_cP3/pub?gid=0&single=true&output=tsv',
            BCV_URL: 'https://ve.dolarapi.com/v1/dolares/oficial', // API p√∫blica para tasa BCV
            PHONE: '584122525407'
        };

        let products = [];
        let cart = [];
        let currentTasa = 0;

        // 1. OBTENER TASA BCV (Inclu√≠do seg√∫n tu solicitud)
        const obtenerTasaBCV = async () => {
            try {
                const response = await fetch(CONFIG.BCV_URL);
                const data = await response.json();
                currentTasa = data.promedio;
                localStorage.setItem('last_bcv', currentTasa);
                document.getElementById('tasa-valor').innerText = currentTasa.toLocaleString('es-VE');
            } catch (error) {
                const respaldo = localStorage.getItem('last_bcv');
                currentTasa = respaldo ? parseFloat(respaldo) : 0;
                document.getElementById('tasa-valor').innerText = currentTasa + " (Respaldo)";
            }
        };

        // 2. CARGAR PRODUCTOS DESDE GOOGLE SHEETS (TSV)
        const loadProducts = async () => {
            try {
                const res = await fetch(CONFIG.SHEET_URL);
                const text = await res.text();
                const rows = text.split('\n').slice(1); // Saltar cabecera
                
                products = rows.map(row => {
                    const [id, name, price, currency, description, category] = row.split('\t');
                    return { id, name, price: parseFloat(price), currency, description, category: category?.trim() };
                }).filter(p => p.name);

                renderProducts(products);
                renderCategories();
            } catch (e) { console.error("Error cargando productos", e); }
        };

        function renderProducts(list) {
            const container = document.getElementById('products-container');
            container.innerHTML = list.map(p => `
                <div class="card-product p-4 rounded-lg border border-zinc-800 flex flex-col justify-between">
                    <div>
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold text-white uppercase">${p.name}</h4>
                            <span class="text-gold font-bold">$${p.price.toFixed(2)}</span>
                        </div>
                        <p class="text-xs text-gray-400 mb-4">${p.description || ''}</p>
                    </div>
                    <button onclick="addToCart('${p.id}')" class="w-full border border-gold text-gold py-1 rounded hover:bg-gold hover:text-black transition text-sm">
                        + Agregar
                    </button>
                </div>
            `).join('');
        }

        function renderCategories() {
            const cats = ['all', ...new Set(products.map(p => p.category))];
            const container = document.getElementById('categories');
            container.innerHTML = cats.map(c => `
                <button onclick="filterCategory('${c}')" class="border border-zinc-700 px-4 py-1 rounded-full text-sm whitespace-nowrap">
                    ${c === 'all' ? 'Todos' : c}
                </button>
            `).join('');
        }

        function filterCategory(cat) {
            if (cat === 'all') renderProducts(products);
            else renderProducts(products.filter(p => p.category === cat));
        }

        // 3. L√ìGICA DEL CARRITO
        function addToCart(id) {
            const product = products.find(p => p.id === id);
            const exists = cart.find(item => item.id === id);
            
            if (exists) exists.quantity++;
            else cart.push({ ...product, quantity: 1 });
            
            updateCartUI();
        }

        function updateCartUI() {
            const count = cart.reduce((acc, item) => acc + item.quantity, 0);
            document.getElementById('cart-count').innerText = count;
            document.getElementById('cart-btn').classList.toggle('hidden', count === 0);
        }

        function openCart() {
            const container = document.getElementById('cart-items');
            let totalUsd = 0;

            container.innerHTML = cart.map(item => {
                const subtotal = item.price * item.quantity;
                totalUsd += subtotal;
                return `
                    <div class="flex justify-between items-center bg-zinc-800 p-3 rounded">
                        <div>
                            <p class="font-bold text-sm">${item.name}</p>
                            <p class="text-xs text-gold">${item.quantity} x $${item.price.toFixed(2)}</p>
                        </div>
                        <div class="flex items-center gap-3">
                            <button onclick="changeQty('${item.id}', -1)" class="w-6 h-6 rounded bg-zinc-700">-</button>
                            <span class="text-sm font-bold">${item.quantity}</span>
                            <button onclick="changeQty('${item.id}', 1)" class="w-6 h-6 rounded bg-zinc-700">+</button>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('total-usd').innerText = `$${totalUsd.toFixed(2)}`;
            document.getElementById('total-bs').innerText = `${(totalUsd * currentTasa).toLocaleString('es-VE')} Bs.`;
            document.getElementById('cart-modal').classList.remove('hidden');
        }

        function changeQty(id, delta) {
            const item = cart.find(i => i.id === id);
            item.quantity += delta;
            if (item.quantity <= 0) cart = cart.filter(i => i.id !== id);
            if (cart.length === 0) closeCart();
            updateCartUI();
            openCart();
        }

        function closeCart() { document.getElementById('cart-modal').classList.add('hidden'); }
        function toggleAbout() { document.getElementById('about-modal').classList.toggle('hidden'); }

        // 4. ENV√çO A WHATSAPP
        function sendOrder() {
            let message = "üèõÔ∏è *NUEVO PEDIDO - THE OFFICE*\n";
            message += "--------------------------\n";
            cart.forEach(item => {
                message += `‚Ä¢ ${item.quantity} x ${item.name} ($${(item.price * item.quantity).toFixed(2)})\n`;
            });
            
            const totalUsd = cart.reduce((acc, i) => acc + (i.price * i.quantity), 0);
            const totalBs = totalUsd * currentTasa;
            
            message += "--------------------------\n";
            message += `*TOTAL USD:* $${totalUsd.toFixed(2)}\n`;
            message += `*TASA BCV:* ${currentTasa} Bs.\n`;
            message += `*TOTAL BS:* ${totalBs.toLocaleString('es-VE')} Bs.\n\n`;
            message += "Por favor, conf√≠rmenme para proceder con el pago. ¬°Gracias!";

            const wpUrl = `https://wa.me/${CONFIG.PHONE}?text=${encodeURIComponent(message)}`;
            window.open(wpUrl, '_blank');
        }

        // Inicializar
        obtenerTasaBCV();
        loadProducts();
    </script>
</body>
</html>
